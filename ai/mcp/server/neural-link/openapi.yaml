openapi: 3.0.0
info:
  title: Neo.mjs Neural Link MCP Server
  version: 1.0.0
paths:
  /health:
    post:
      summary: Health Check
      operationId: healthcheck
      x-annotations:
        readOnlyHint: true
      description: |
        Checks the health of the Neural Link server, including WebSocket connectivity and active sessions.

        **When to Use:**
        Use this as a first-step diagnostic tool to ensure the Neural Link bridge to the browser is operational.
      tags: [Health]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
        '503':
          description: Server is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /component/property/get:
    post:
      summary: Get Component Property
      operationId: get_component_property
      x-pass-as-object: true
      description: |
        Retrieves a property from a component by its ID.

        **When to Use:**
        To inspect the current state of a component (e.g., `width`, `store`, `value`).
      tags: [Component]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetComponentPropertyRequest'
      responses:
        '200':
          description: The value of the property
          content:
            application/json:
              schema:
                description: The property value
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /component/tree:
    post:
      summary: Get Component Tree
      operationId: get_component_tree
      x-pass-as-object: true
      description: |
        Retrieves the full component tree of the application.

        **When to Use:**
        To understand the structure of the UI, find component IDs, or debug hierarchy issues.
      tags: [Component]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetComponentTreeRequest'
      responses:
        '200':
          description: The component tree structure
          content:
            application/json:
              schema:
                type: object
                description: The component tree
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /component/vdom/get:
    post:
      summary: Get Component VDOM Tree
      operationId: get_vdom_tree
      x-pass-as-object: true
      description: |
        Retrieves the VDOM tree of a component.

        **When to Use:**
        To inspect the Virtual DOM structure of a component for rendering issues.
      tags: [Component]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetComponentTreeRequest'
      responses:
        '200':
          description: The VDOM tree structure
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /component/vnode/get:
    post:
      summary: Get Component VNode Tree
      operationId: get_vnode_tree
      x-pass-as-object: true
      description: |
        Retrieves the VNode tree of a component.

        **When to Use:**
        To inspect the actual DOM-aligned VNodes (after VDOM processing). Useful for deep rendering debugging.
      tags: [Component]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetComponentTreeRequest'
      responses:
        '200':
          description: The VNode tree structure
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /data/store/inspect:
    post:
      summary: Inspect Store
      operationId: inspect_store
      x-pass-as-object: true
      description: |
        Inspects a specific data store.

        **When to Use:**
        To see the actual records, filters, sorters, and count of a Store.
      tags: [Data]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InspectStoreRequest'
      responses:
        '200':
          description: Store details
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  count:
                    type: integer
                  model:
                    type: string
                  filters:
                    type: array
                  sorters:
                    type: array
                  items:
                    type: array

  /data/store/list:
    post:
      summary: List Stores
      operationId: list_stores
      x-pass-as-object: true
      description: |
        Lists all active data stores.

        **When to Use:**
        To find available stores in the application.
      tags: [Data]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListStoresRequest'
      responses:
        '200':
          description: List of stores
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    model:
                      type: string
                    count:
                      type: integer

  /data/record/get:
    post:
      summary: Get Record
      operationId: get_record
      x-pass-as-object: true
      description: |
        Retrieves a specific data record.

        **When to Use:**
        To inspect the full data of a single record.
      tags: [Data]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetRecordRequest'
      responses:
        '200':
          description: Record data
          content:
            application/json:
              schema:
                type: object

  /drag/state:
    post:
      summary: Get Drag State
      operationId: get_drag_state
      x-pass-as-object: true
      description: |
        Retrieves the state of the DragCoordinator.

        **When to Use:**
        To debug drag-and-drop operations, checking what is being dragged and where.
      tags: [Inspection]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                  description: Target App Worker Session ID
      responses:
        '200':
          description: Drag Coordinator State
          content:
            application/json:
              schema:
                type: object

  /component/query:
    post:
      summary: Query Components
      operationId: query_component
      x-pass-as-object: true
      description: |
        Finds components matching a set of properties (semantic query).
        Example: `query_component({selector: {ntype: 'button', text: 'Save'}})`

        **When to Use:**
        To find components without knowing their ID, using fuzzy matching on properties.
      tags: [Component]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryComponentRequest'
      responses:
        '200':
          description: List of matching components
          content:
            application/json:
              schema:
                type: object
                properties:
                  components:
                    type: array
                    items:
                      type: object

  /page/reload:
    post:
      summary: Reload Page
      operationId: reload_page
      x-pass-as-object: true
      description: |
        Reloads the application page.

        **When to Use:**
        To force a full reload of the connected application window.
      tags: [Lifecycle]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReloadPageRequest'
      responses:
        '200':
          description: Page reloaded successfully
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /server/start:
    post:
      summary: Start WebSocket Server
      operationId: start_ws_server
      description: |
        Starts the WebSocket server to accept connections from the Neo.mjs app.

        **When to Use:**
        Use this to recover the bridge if the server was previously stopped or crashed.
      tags: [Lifecycle]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Server started successfully
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /server/stop:
    post:
      summary: Stop WebSocket Server
      operationId: stop_ws_server
      description: |
        Stops the WebSocket server and closes all active connections.

        **When to Use:**
        Use this to simulate a network disconnect or to perform a clean shutdown of the bridge.
      tags: [Lifecycle]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Server stopped successfully
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /worker/topology:
    post:
      summary: Get Worker Topology
      operationId: get_worker_topology
      description: |
        Retrieves the topology of all connected App Workers.

        **When to Use:**
        To discover connected workers, their session IDs, and environments.
      tags: [Topology]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: List of App Workers
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    sessionId:
                      type: string
                    appWorkerId:
                      type: string
                    isSharedWorker:
                      type: boolean
                    userAgent:
                      type: string
                    environment:
                      type: string
                    connectedAt:
                      type: number

  /window/topology:
    post:
      summary: Get Window Topology
      operationId: get_window_topology
      description: |
        Retrieves the topology of all connected windows.

        **When to Use:**
        To map logical window IDs to physical browser windows and their dimensions.
      tags: [Topology]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: List of windows
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    appName:
                      type: string
                    innerRect:
                      type: object
                    outerRect:
                      type: object
                    chrome:
                      type: object

  /component/property/set:
    post:
      summary: Set Component Property
      operationId: set_component_property
      x-pass-as-object: true
      description: |
        Sets a property on a component by its ID.

        **When to Use:**
        To modify the runtime state of a component (e.g., change text, toggle visibility).
      tags: [Component]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetComponentPropertyRequest'
      responses:
        '200':
          description: Property set successfully
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded]
        timestamp:
          type: string
          format: date-time
        server:
          type: object
          properties:
            port:
              type: integer
            activeSessions:
              type: integer
            connectedWindows:
              type: integer
        details:
          type: array
          items:
            type: string
        version:
          type: string
        uptime:
          type: number

    GetComponentPropertyRequest:
      type: object
      required:
        - id
        - property
      properties:
        id:
          type: string
          description: The component ID
        property:
          type: string
          description: The property name to retrieve
        sessionId:
          type: string
          description: The target App Worker Session ID

    QueryComponentRequest:
      type: object
      required:
        - selector
      properties:
        selector:
          type: object
          description: JSON object with property/value pairs to match (e.g., {ntype: 'button', text: 'Save'}).
        rootId:
          type: string
          description: Optional ID of a component to search within (scoped search).
        sessionId:
          type: string
          description: The target App Worker Session ID

    GetComponentTreeRequest:
      type: object
      properties:
        rootId:
          type: string
          description: Optional root component ID. Defaults to the App's MainView if available.
        depth:
          type: integer
          description: Depth limit. 1=Self, 2=Self+Children, -1=Infinite.
        sessionId:
          type: string
          description: The target App Worker Session ID

    ReloadPageRequest:
      type: object
      properties:
        sessionId:
          type: string
          description: The target App Worker Session ID

    SetComponentPropertyRequest:
      type: object
      required:
        - id
        - property
        - value
      properties:
        id:
          type: string
          description: The component ID
        property:
          type: string
          description: The property name to set
        value:
          description: The value to set
        sessionId:
          type: string
          description: The target App Worker Session ID

    InspectStoreRequest:
      type: object
      required:
        - storeId
      properties:
        storeId:
          type: string
          description: The ID of the store to inspect
        sessionId:
          type: string
          description: The target App Worker Session ID

    ListStoresRequest:
      type: object
      properties:
        sessionId:
          type: string
          description: The target App Worker Session ID

    GetRecordRequest:
      type: object
      required:
        - recordId
      properties:
        recordId:
          type: string
          description: The ID of the record to retrieve
        storeId:
          type: string
          description: Optional Store ID to scope the search
        sessionId:
          type: string
          description: The target App Worker Session ID

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
