openapi: 3.0.3
info:
  title: Neo.mjs GitHub Workflow MCP Server API
  description: |
    This API provides structured access to the GitHub CLI (`gh`) to streamline and automate 
    contribution workflows for the Neo.mjs project. It enables AI agents to interact with 
    pull requests and issues programmatically.
  version: 1.0.0
  contact:
    name: Neo.mjs Project
    url: https://github.com/neomjs/neo
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8002
    description: Local development server

tags:
  - name: Health
    description: Server health and status endpoints
  - name: Pull Requests
    description: Operations related to GitHub Pull Requests

paths:
  /docs:
    get:
      summary: API Documentation
      description: Serves the interactive Swagger UI for this API
      tags: [Health]
      responses:
        '200':
          description: Swagger UI HTML page
          content:
            text/html:
              schema:
                type: string

  /healthcheck:
    get:
      summary: Health Check
      description: Confirms the server is running and the `gh` CLI is accessible.
      tags: [Health]
      responses:
        '200':
          description: Server is healthy and `gh` is available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
        '503':
          description: Server is unhealthy or `gh` CLI is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests:
    get:
      summary: List Pull Requests
      description: Retrieves a list of open pull requests from the GitHub repository.
      tags: [Pull Requests]
      parameters:
        - name: limit
          in: query
          required: false
          description: Maximum number of pull requests to return.
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
        - name: state
          in: query
          required: false
          description: Filter pull requests by state.
          schema:
            type: string
            enum: [open, closed, merged, all]
            default: open
      responses:
        '200':
          description: A list of open pull requests.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PullRequestListResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/checkout:
    post:
      summary: Checkout PR Branch
      description: Checks out the branch for a given pull request locally using `gh pr checkout`.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request to check out.
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Pull request branch checked out successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/diff:
    get:
      summary: Get PR Diff
      description: Retrieves the diff for a specific pull request using `gh pr diff`.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request.
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: The diff of the pull request.
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/comments:
    post:
      summary: Create a PR Comment
      description: Adds a comment to a specific pull request.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request to comment on.
          schema:
            type: integer
            example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - body
              properties:
                body:
                  type: string
                  description: The content of the comment.
                  example: "This looks great!"
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/conversation:
    get:
      summary: Get PR Conversation
      description: Retrieves the full conversation for a pull request, including the title, body, and all comments.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request.
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: The pull request conversation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PullRequestConversation'
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        githubCli:
          type: object
          properties:
            installed:
              type: boolean
              example: true
            authenticated:
              type: boolean
              example: true
        version:
          type: string
          example: "1.0.0"
        uptime:
          type: number
          description: Server uptime in seconds
          example: 3600

    PullRequest:
      type: object
      properties:
        number:
          type: integer
          example: 123
        title:
          type: string
          example: "feat: Add new component"
        author:
          type: string
          example: "some-contributor"
        url:
          type: string
          format: uri
          example: "https://github.com/neomjs/neo/pull/123"
        state:
          type: string
          enum: [OPEN, CLOSED, MERGED]
          example: "OPEN"
        createdAt:
          type: string
          format: date-time
          example: "2025-10-08T12:00:00.000Z"

    PullRequestListResponse:
      type: object
      properties:
        count:
          type: integer
          description: Number of pull requests returned
          example: 5
        pullRequests:
          type: array
          items:
            $ref: '#/components/schemas/PullRequest'

    PullRequestConversation:
      type: object
      properties:
        title:
          type: string
        body:
          type: string
        comments:
          type: array
          items:
            type: object
            properties:
              author:
                type: object
                properties:
                  login:
                    type: string
              body:
                type: string
              createdAt:
                type: string
                format: date-time

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          example: "Operation completed successfully"
        details:
          type: string
          description: Optional details from the CLI output.
          example: "Checked out branch 'some-contributor/my-feature-branch'"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "GitHub CLI command failed"
        message:
          type: string
          example: "gh pr checkout 123 failed with exit code 1"
        code:
          type: string
          example: "GH_CLI_ERROR"
