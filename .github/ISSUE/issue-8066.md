---
id: 8066
title: Standardize Renderer Component Lifecycle Management
state: OPEN
labels:
  - ai
  - refactoring
  - architecture
assignees: []
createdAt: '2025-12-09T01:48:45Z'
updatedAt: '2025-12-09T01:48:45Z'
githubUrl: 'https://github.com/neomjs/neo/issues/8066'
author: tobiu
commentsCount: 0
parentIssue: null
subIssues: []
subIssuesCompleted: 0
subIssuesTotal: 0
blockedBy: []
blocking: []
---
# Standardize Renderer Component Lifecycle Management

Refactor the management of child components generated by renderers to ensure consistent lifecycle handling (mounting/destroying) across different contexts (LivePreview vs ContentComponent).

**Problem:**
`ContentComponent` manually manages the `mounted` state of Markdown-embedded components (`livePreviews`, `customComponents`) to support re-mounting (e.g., navigating between portal tabs). This logic is tightly coupled to the container and not reusable by `LivePreview` when running in `markdown` mode.

**Solution:**
Shift the responsibility of managing these "floating" components to the renderer that creates them.

**Changes:**
1.  **`src/code/renderer/Markdown.mjs`**:
    *   Add `activeComponents` array to track created instances.
    *   Implement `updateComponentState(mounted)`: Iterates `activeComponents` and sets their `mounted` config.
    *   Implement `destroyComponents()`: Destroys all `activeComponents` and clears the array.
    *   Update `render()` to populate `activeComponents` instead of returning them.

2.  **`src/code/renderer/Base.mjs`**:
    *   Define abstract `updateComponentState(mounted)` (no-op by default).
    *   Define abstract `destroyComponents()` (no-op by default).

3.  **`src/code/LivePreview.mjs`**:
    *   Remove `customComponents` and `livePreviews`.
    *   Implement `afterSetMounted(value)`: Call `this.renderer?.updateComponentState(value)`.
    *   Update `destroyChildInstances`: Call `this.renderer?.destroyComponents()`.

4.  **`apps/portal/view/learn/ContentComponent.mjs`**:
    *   Remove `customComponents` and `livePreviews`.
    *   Update `afterSetMounted`: Delegate to `this.renderer?.updateComponentState(value)`.
    *   Update `destroyChildInstances`: Delegate to `this.renderer?.destroyComponents()`.

**Goal:**
Decouple component lifecycle management from the container view, ensuring `LivePreview` and `ContentComponent` can both correctly handle re-mounting scenarios for Markdown content.

## Activity Log

- 2025-12-09 @tobiu added the `ai` label
- 2025-12-09 @tobiu added the `refactoring` label
- 2025-12-09 @tobiu added the `architecture` label

