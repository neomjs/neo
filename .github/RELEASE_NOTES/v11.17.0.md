---
tagName: 11.17.0
name: Neo.mjs v11.17.0 Release Notes
publishedAt: '2025-12-21T16:20:00Z'
isPrerelease: false
isDraft: false
---
# Neo.mjs v11.17.0 Release Notes

**Release Type:** Feature Release
**Stability:** Production-ready
**Breaking Changes:** None (Major Internal Refactoring)
**Upgrade Path:** Drop-in replacement for v11.16.0

---

**Core Architecture & Multi-Window Precision**

This release is a powerhouse, resolving **107 tickets** in just over two weeks. From a sheer scope perspective‚Äîintroducing a new flagship app, overhauling the core rendering engine, and redefining multi-window architecture‚Äîthis could easily justify a major version bump.

However, we are sticking to **v11.17.0**. Why? Because we have even bigger plans for v12. Consider this the "final form" of the v11 series: a highly polished, performant foundation that sets the stage for the next evolutionary leap.

This update focuses on deep architectural precision. We have **consolidated the Main thread's queue system**, moving from a triple Read-Write-Update model to a streamlined Read-Write model for better batching efficiency.

Crucially, we have enhanced the **VDOM & VNode architecture** to treat scroll state (`scrollTop`, `scrollLeft`) as first-class properties. This allows us to capture and restore scroll positions seamlessly across all rendering modes‚Äî**DomApiRenderer**, **StringBasedRenderer**, and even **SSR** scenarios via new post-update queues.

These capabilities necessitated a fundamental shift in our multi-window architecture. We have deprecated the ambiguous `'main'` destination for worker messages, **enforcing explicit `windowId` routing** to ensure precision in multi-window applications. Consequently, **all remote methods** have been refactored to explicitly pass `windowId`, eliminating ambiguity when communicating through the main thread.

Furthermore, we are solidifying the **AgentOS** ecosystem with the introduction of the **Legit** app (a dedicated Git GUI) and significant upgrades to the Dashboard.

---

## ‚ú® Highlights

### üöÄ Legit: A Neo.mjs Implementation
We are excited to showcase a new demo application developed in cooperation with **Martin**, founder of the **Legit** open-source project.

*   **The Project:** Legit is an innovative, standalone OSS Git client. This demo represents a port of its core concepts into the Neo.mjs ecosystem, validating our platform's capability to handle complex, desktop-grade development tools.
*   **Architecture:** The app introduces a dedicated Service worker architecture (`Legit.service.Legit`), ensuring that heavy Git operations (like log parsing) never block the UI thread.
*   **Features:**
    *   **Commit History Grid:** A virtualized grid visualization of repository history using `Neo.grid.Container`.
    *   **Service-Worker Integration:** A reference implementation for offloading computationally intensive tasks to dedicated workers.

### ‚öõÔ∏è Core Refactoring: Architectural Precision
We performed a massive, deep-dive refactoring of the core rendering pipeline and worker architecture. These changes eliminate race conditions, reduce memory overhead, and ensure buttery-smooth performance.

*   **Rendering Pipeline:**
    *   **Unified Update Strategy:** We merged the manual DOM update path (`App.applyDeltas`) with the VDOM update pipeline. Both now use a standardized `updateVdom` action, ensuring consistent `requestAnimationFrame` synchronization across the board.
    *   **Read/Write Queues:** The Main thread (`Neo.Main`) now strictly enforces a consolidated **Read/Write** queue model, replacing the legacy triple-queue system. This maximizes DOM batching efficiency.
    *   **Zero-Delta Optimization:** `Neo.worker.Manager` now intelligently intercepts and drops "empty" updates before they needlessly occupy the main thread.
    *   **AutoMount as Delta:** The "magic" `autoMount` process has been transformed into a standard `insertNode` delta operation, unifying the mounting logic.
    *   **Mount Refactor:** `mount()` is now a direct, lightweight alias for `initVnode(true)`, removing the legacy `VdomLifecycle` overhead for unmounted components.

*   **State & Scroll Management:**
    *   **Save Scroll Position:** `scrollTop` and `scrollLeft` are now first-class citizens in the VNode structure. This allows scroll state to be captured live (`onScrollCapture`) and **automatically restored** when components are moved or re-mounted (e.g., during drag-and-drop or tab switching).
    *   **Grid Scroll Sync:** Fixed a critical race condition in Buffered Grids by enforcing bidirectional synchronization of scroll state between the Main thread and VDOM worker.

*   **Architecture & Memory:**
    *   **Explicit Window IDs:** We are migrating away from the ambiguous `'main'` destination string. Cross-worker communication now prioritizes explicit `windowId` routing, essential for robust Multi-Window applications.
    *   **Async Remote Registration:** Remote method registration (`promiseRemotes`) is now fully asynchronous and deterministic, eliminating race conditions during application startup.
    *   **Symbol-Based Store Sorting:** Refactored `Neo.data.Store` to use a lightweight `initialIndexSymbol` for tracking insertion order. This removes the need to duplicate the entire dataset for state restoration, significantly reducing memory usage for large stores.

### üß© SortZone & Dashboard Polish: "Drag-to-Popup" Perfection
The multi-window drag-and-drop experience (dragging a widget from a dashboard out to a new window) has received a major upgrade.
*   **DragProxyContainer:** We moved away from cloning DOM nodes manually. Now, a lightweight `DragProxyContainer` manages the visual representation of the dragged item, supporting live component updates during the drag.
*   **Auto-Stealing:** Components now intelligently "steal" ownership of themselves when moving between contexts, preventing state corruption.
*   **Window Animations:** When a widget is dragged out of the dashboard, the remaining items now smoothly animate to fill the gap, creating a more polished, native-app feel.
*   **Refactoring:** Renamed `container.sortable` to `container.dragResortable` to better reflect its capabilities.

### üñ•Ô∏è Multi-Window Architecture: Explicit Window IDs
We have deprecated the generic `'main'` destination for cross-window messaging.
*   **Explicit Addressing:** The architecture now enforces explicit Window IDs for all remote method calls and state propagation. This eliminates ambiguity in multi-window apps where "main" could refer to the opener or the current context.
*   **Canvas Migration:** `OffscreenCanvas` nodes can now be transferred between windows (SharedWorkers) without losing their state or context, enabling seamless 3D/2D visualization portability.

### üìù LivePreview: Nested Multi-Window Apps
The `code.LivePreview` component‚Äîthe heart of our docs and runnable examples‚Äîhas received a transformative update.
*   **Markdown Support:** LivePreviews can now render Markdown files directly.
*   **Recursive App Generation:** The most powerful feature is that **code blocks within the Markdown output are automatically converted into nested LivePreviews.**
    *   This effectively creates **"nested multi-window apps"**: A LivePreview component can load a Markdown file, which in turn spawns new LivePreview instances for each code block it contains.
    *   This recursive architecture allows for incredibly rich, interactive documentation where examples are fully functional applications running inside the document flow.
*   **Pluggable Renderers:** This is powered by a new pluggable architecture where renderers (Markdown, HTML, JS) are modular, making the component easier to extend.
*   **Neo.component.Markdown:** A new, dedicated component for rendering Markdown. It encapsulates all parsing logic and supports "eager" rendering, significantly speeding up the documentation app.

---

## üì¶ Full Changelog

### üöÄ New Features & Apps
*   **Legit App:** Initial release of the Git client with Service architecture (#8108, #8110, #8133)
*   **Legit Viewport:** Enhanced UX, file writing, and footer toolbar (#8109, #8060, #8061)
*   **AgentOSStrategy:** New child app for isolated strategy views (#8111)
*   **StrategyPanel:** Modular AgentOS strategy view with horizontal DnD (#8038, #8039)
*   **Neo.component.Markdown:** Dedicated, optimized Markdown renderer (#8067, #8068, #8075)
*   **Container Enhancements:** Added `silent` parameter to `add()` (#8047) and `removeFromPreviousParent` support (#8113)
*   **Theming:** Support for `additionalThemeFiles` to load external styles (#8117)
*   **AgentOS UI:** Adjusted Viewport flex ratios (#8042) and logo (#8105)

### ‚ö° Performance & Core
*   **Zero-Delta Updates:** Manager optimization to skip empty VDOM diffs (#8125)
*   **Mount Refactor:** Removed VdomLifecycle overhead (#8132, #8134)
*   **Unified Delays:** Centralized DOM update strategy to fix race conditions (#8124)
*   **Read/Write Queues:** Consolidated main thread task management (#8131)
*   **Store Optimization:** Eager record initialization (#8085, #8097, #8077, #8078) and redundant check avoidance (#8095)
*   **Symbol-Based Sorting:** Refactored Store sorting for memory efficiency (#8094)
*   **VDOM State:** Bidirectional scroll sync (#8151) and `VDom.getById` implementation (#8140)
*   **LivePreview:** Optimized `doRunSource` (#8083) and container updates (#8084)
*   **Worker Manager:** Refactored `onWorkerMessage` redundancy (#8126) and optimized autoMount (#8129, #8130)

### üñ±Ô∏è UX & Interactions
*   **DragProxyContainer:** Live component dragging with auto-stealing (#8044, #8045, #8112)
*   **Dashboard Animations:** Smooth layout transitions during window drag (#8141)
*   **Drag-to-Popup:** Standardized logic in ViewportControllers (#8115) and fixed event routing (#8114)
*   **SortZone:** Renamed to `dragResortable` (#8092), fixed gap handling (#8043), and unified creation logic (#8087, #8090, #8091, #8093)
*   **Manual DOM Delta:** Implemented strategy for live component dragging (#8053)
*   **Event Delegation:** Implemented Logical Ancestry (#8051, #8056, #8057) and Physical Anchor verification (#8058)
*   **Flexbox:** Fixed shorthand parsing for numeric flex values (#8041)

### üõ†Ô∏è Infrastructure & Refactoring
*   **Window IDs:** Migration to explicit window addressing (#8149, #8153)
*   **Canvas:** Support for moving OffscreenCanvas between windows (#8118, #8119)
*   **LivePreview Architecture:** Pluggable renderers (#8063, #8069), internal multi-window logic (#8071), and nested window support (#8074)
*   **LivePreview Lifecycle:** Standardized component management (#8066) and optimized loading (#8064)
*   **Remote Methods:** Async registration with robust worker checking (#8147) and multi-window fix (#8148)
*   **Memory Core:** Request deduplication for HealthServices (#8104)
*   **GitHub Workflow:** Added `syncOnStartup` config (#8103)
*   **Agent Protocol:** Mandated sub-agent context injection (#8102)

### üõ°Ô∏è Quality Assurance & Hardening
Given the massive scope of the core refactorings in this release, we maintained a rigorous testing standard. This list highlights specific regressions and edge cases that were identified and resolved during the development cycle to ensure v11.17.0 retains the rock-solid stability of its predecessor.

*   **VDOM Race Condition:** Fixed initialization collision for child updates (#8123)
*   **Popup Sizing:** Fixed rounding errors, caching, and race conditions (#8121)
*   **Re-integration:** Fixed DOM updates when dragging back from popup (#8143, #8144, #8145)
*   **SortZone:** Fixed sorting corruption after multiple drags (#8054) and layout calculation regression (#8120)
*   **Drag Proxy:** Fixed cleanup failure on window drop (#8116)
*   **Monaco Editor:** Fixed double-initialization regression (#8150) and validation (#8070)
*   **Store:** Fixed `isLoaded` regression (#8100) and `initialIndexSymbol` assignment (#8099)
*   **Calendar:** Fixed Week View DnD state regression (#8076) and YearComponent state (#8098)
*   **DOM Events:** Fixed mapping for wrapper nodes (#8088) and logical bubbling (#8050)
*   **ResizeObserver:** Enabled for Canvas auto-resize (#8146)
*   **WebPack:** Fixed dynamic import errors in Legit service (#8133)
*   **ApplyDeltas:** Hardened against single delta objects (#8135)
*   **Worker Manager:** Fixed deadlock in silent VNode creation (#8055) and autoMount regression (#8128)

### üìö Documentation & Tests
*   **Guides:** Created "Worker Architecture & Messaging" guide (#8136)
*   **Source Docs:** Enhanced SortZone (#8142) and Renderer (#8065) JSDoc
*   **Tests:** Added unit tests for SortZone (#8086), DomEvent fire (#8059), Custom VDOM Root (#8089), and Store (#8096)
*   **Testbed:** Duplicated childapps/preview for Legit testing (#8073)
