openapi: 3.0.3
info:
  title: Neo.mjs GitHub Workflow MCP Server API
  description: |
    This API provides structured access to the GitHub CLI (`gh`) to streamline and automate 
    contribution workflows for the Neo.mjs project. It enables AI agents to interact with 
    pull requests and issues programmatically.
  version: 1.0.0
  contact:
    name: Neo.mjs Project
    url: https://github.com/neomjs/neo
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8002
    description: Local development server

tags:
  - name: Health
    description: Server health and status endpoints
  - name: Pull Requests
    description: Operations related to GitHub Pull Requests
  - name: Labels
    description: Operations related to repository labels
  - name: Issues
    description: Operations related to repository issues and pull requests

paths:
  /docs:
    get:
      summary: API Documentation
      description: Serves the interactive Swagger UI for this API
      tags: [Health]
      responses:
        '200':
          description: Swagger UI HTML page
          content:
            text/html:
              schema:
                type: string

  /healthcheck:
    get:
      summary: Check GitHub CLI Health
      operationId: healthcheck
      x-annotations:
        readOnlyHint: true
      description: |
        Verifies that the GitHub CLI (`gh`) is installed, authenticated, and 
        meets the minimum version requirement. Use this to diagnose setup issues.
      tags: [Health]
      responses:
        '200':
          description: Server is healthy and `gh` is available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
        '503':
          description: Server is unhealthy or `gh` CLI is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /labels:
    get:
      summary: List Repository Labels
      operationId: list_labels
      x-annotations:
        readOnlyHint: true
      description: Retrieves a list of all available labels in the repository.
      tags: [Labels]
      responses:
        '200':
          description: A list of repository labels.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LabelListResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests:
    get:
      summary: List Pull Requests
      operationId: list_pull_requests
      x-pass-as-object: true
      x-annotations:
        readOnlyHint: true
      description: Retrieves a list of open pull requests from the GitHub repository.
      tags: [Pull Requests]
      parameters:
        - name: limit
          in: query
          required: false
          description: Maximum number of pull requests to return.
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
        - name: state
          in: query
          required: false
          description: Filter pull requests by state.
          schema:
            type: string
            enum: [open, closed, merged, all]
            default: open
      responses:
        '200':
          description: A list of open pull requests.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PullRequestListResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/checkout:
    post:
      summary: Checkout PR Branch
      operationId: checkout_pull_request
      x-annotations:
        readOnlyHint: false
      description: Checks out the branch for a given pull request locally using `gh pr checkout`.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request to check out.
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Pull request branch checked out successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/diff:
    get:
      summary: Get PR Diff
      operationId: get_pull_request_diff
      x-annotations:
        readOnlyHint: true
      description: Retrieves the diff for a specific pull request using `gh pr diff`.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request.
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: The diff of the pull request.
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/comments:
    post:
      summary: Create a PR Comment
      operationId: create_comment
      x-annotations:
        readOnlyHint: false
      description: Adds a comment to a specific pull request.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request to comment on.
          schema:
            type: integer
            example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - body
              properties:
                body:
                  type: string
                  description: The content of the comment.
                  example: "This looks great!"
      responses:
        '201':
          description: Comment created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pull-requests/{pr_number}/conversation:
    get:
      summary: Get PR Conversation
      operationId: get_conversation
      x-annotations:
        readOnlyHint: true
      description: Retrieves the full conversation for a pull request, including the title, body, and all comments.
      tags: [Pull Requests]
      parameters:
        - name: pr_number
          in: path
          required: true
          description: The number of the pull request.
          schema:
            type: integer
            example: 123
      responses:
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /issues/{issue_number}/labels:
    post:
      summary: Add labels to an issue or PR
      operationId: add_labels
      x-annotations:
        readOnlyHint: false
      description: Adds one or more labels to a specific issue or pull request.
      tags: [Issues]
      parameters:
        - name: issue_number
          in: path
          required: true
          description: The number of the issue or pull request.
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - labels
              properties:
                labels:
                  type: array
                  items:
                    type: string
                  example: ["bug", "enhancement"]
      responses:
        '200':
          description: Labels added successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Issue or pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Remove labels from an issue or PR
      operationId: remove_labels
      x-annotations:
        readOnlyHint: false
        destructiveHint: true
      description: Removes one or more labels from a specific issue or pull request.
      tags: [Issues]
      parameters:
        - name: issue_number
          in: path
          required: true
          description: The number of the issue or pull request.
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - labels
              properties:
                labels:
                  type: array
                  items:
                    type: string
                  example: ["bug", "enhancement"]
      responses:
        '200':
          description: Labels removed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Issue or pull request not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error, e.g., `gh` command failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /issues/{issue_number}/content:
    get:
      summary: Get Local Issue Content by ID
      operationId: get_local_issue_by_id
      x-annotations:
        readOnlyHint: true
      description: Retrieves the full markdown content of a local issue file by its number, searching both active and archived issues.
      tags: [Issues]
      parameters:
        - name: issue_number
          in: path
          required: true
          description: The number of the issue (e.g., "7608" or "#7608").
          schema:
            type: string
      responses:
        '200':
          description: The content and path of the issue file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocalIssueResponse'
        '404':
          description: Issue file not found locally.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sync-all:
    post:
      summary: Sync GitHub Issues & Releases
      operationId: sync_all
      x-annotations:
        readOnlyHint: false
      description: |
        Triggers the bi-directional synchronization process for GitHub issues.
        Pushes local Markdown file changes to GitHub and pulls the latest issue
        and comment data from GitHub to the local files.
      tags: [Issues]
      responses:
        '200':
          description: Synchronization process completed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncIssuesResponse'
        '500':
          description: Internal server error during the sync process.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          description: The ISO 8601 timestamp of when the health check was performed.
        githubCli:
          type: object
          properties:
            installed:
              type: boolean
              example: true
            authenticated:
              type: boolean
              example: true
            versionOk:
              type: boolean
              example: true
            version:
              type: string
              example: "2.81.0"
            details:
              type: array
              items:
                type: string

    Label:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        color:
          type: string

    LabelListResponse:
      type: object
      properties:
        count:
          type: integer
        labels:
          type: array
          items:
            $ref: '#/components/schemas/Label'

    PullRequest:
      type: object
      properties:
        number:
          type: integer
          example: 123
        title:
          type: string
          example: "feat: Add new component"
        author:
          type: object
          properties:
            login:
              type: string
              example: "some-contributor"
        url:
          type: string
          format: uri
          example: "https://github.com/neomjs/neo/pull/123"
        state:
          type: string
          enum: [OPEN, CLOSED, MERGED]
          example: "OPEN"
        createdAt:
          type: string
          format: date-time
          example: "2025-10-08T12:00:00.000Z"

    PullRequestListResponse:
      type: object
      properties:
        count:
          type: integer
          description: Number of pull requests returned
          example: 5
        pullRequests:
          type: array
          items:
            $ref: '#/components/schemas/PullRequest'

    PullRequestConversation:
      type: object
      properties:
        title:
          type: string
        body:
          type: string
        author:
          type: object
          properties:
            login:
              type: string
              description: The GitHub username of the PR author.
        comments:
          type: array
          items:
            type: object
            properties:
              author:
                type: object
                properties:
                  login:
                    type: string
                    description: The GitHub username of the comment author.
              body:
                type: string
              createdAt:
                type: string
                format: date-time

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          example: "Operation completed successfully"
        details:
          type: string
          description: Optional details from the CLI output.
          example: "Checked out branch 'some-contributor/my-feature-branch'"

    SyncIssuesResponse:
      type: object
      required:
        - success
        - summary
        - statistics
        - timing
      properties:
        success:
          type: boolean
          example: true
          description: Whether the sync operation completed successfully
        summary:
          type: string
          example: "Synchronization complete"
          description: Human-readable summary of the sync operation
        statistics:
          type: object
          required:
            - pushed
            - pulled
            - dropped
            - releases
          properties:
            pushed:
              type: object
              properties:
                count:
                  type: integer
                  example: 2
                  description: Number of local changes pushed to GitHub
                issues:
                  type: array
                  items:
                    type: integer
                  example: [1234, 1235]
                  description: Issue numbers that were pushed
                failures:
                  type: array
                  items:
                    type: integer
                  example: [1236]
                  description: Issue numbers that failed to push
            pulled:
              type: object
              properties:
                count:
                  type: integer
                  example: 15
                  description: Total number of issues pulled from GitHub
                created:
                  type: integer
                  example: 3
                  description: Number of new issues created locally
                updated:
                  type: integer
                  example: 12
                  description: Number of existing issues updated locally
                moved:
                  type: integer
                  example: 2
                  description: Number of issues moved between directories
                issues:
                  type: array
                  items:
                    type: integer
                  example: [1230, 1231, 1232]
                  description: Issue numbers that were pulled
            dropped:
              type: object
              properties:
                count:
                  type: integer
                  example: 1
                  description: Number of dropped issues removed locally
                issues:
                  type: array
                  items:
                    type: integer
                  example: [999]
                  description: Issue numbers that were dropped
            releases:
              type: object
              properties:
                count:
                  type: integer
                  example: 5
                  description: Number of release notes synced
                synced:
                  type: array
                  items:
                    type: string
                  example: ['v11.0', 'v10.9', 'v10.8']
                  description: Release version tags that were synced
        timing:
          type: object
          required:
            - startTime
            - endTime
            - durationMs
          properties:
            startTime:
              type: string
              format: date-time
              example: "2025-10-21T10:00:00.000Z"
              description: ISO timestamp when sync started
            endTime:
              type: string
              format: date-time
              example: "2025-10-21T10:02:30.000Z"
              description: ISO timestamp when sync completed
            durationMs:
              type: integer
              example: 150000
              description: Total sync duration in milliseconds

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "GitHub CLI command failed"
        message:
          type: string
          example: "gh pr checkout 123 failed with exit code 1"
        code:
          type: string
          example: "GH_CLI_ERROR"

    LocalIssueResponse:
      type: object
      properties:
        filePath:
          type: string
          description: The absolute path to the found issue file.
          example: /path/to/project/.github/ISSUES/issue-7608.md
        content:
          type: string
          description: The full markdown content of the issue file.
